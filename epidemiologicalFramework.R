### epidemiology script###

##1.  read the data set with the steady states of E, and P 
##2. define the important characteristics: R0, virulence, transmission probability
##3. calculate the R0 for every read steady state
##4. save it into a file. 


#remove old values to avoid trouble
rm(list=ls())

#define functions----
R0<-function(params, model)
{
  with(as.list(params),{
    
    #calculate relevant parameters
    beta_vh <- beta_0*alpha*P
    
    beta_hv <- beta_0*P
    
    
    #beta_hv <- beta_0*alpha_1*P#/(0.5+beta_0*m*P) #beta as a saturating function of virulence
    
    if(model == "linear")
    {
      nu_h <- nu_0*alpha*P
    }else if(model == "saturating")
    {  
      nu_h <- nu_0*alpha*P/(h+P)
    }
    vector<- beta_vh*S_v /(delta_v + nu_v + gamma_v)
    human<- beta_hv*S_h /(delta_h + nu_h + gamma_h)
    R0 <- vector*human
    return(list(R0,nu_h))
  })
}


# define the directory and file names----
OUT_DIR <-paste("~/Documents/Projects/Malaria/resourceExplotaition/results/", Sys.Date(), "/", sep="")
IN_DIR<-paste("~/Documents/Projects/Malaria/resourceExplotaition/results/", Sys.Date(), "/", sep="")

IN_DIR <-"~/Documents/Projects/Malaria/resourceExplotaition/results/2018-05-29/"
OUT_DIR <-"~/Documents/Projects/Malaria/resourceExplotaition/results/2018-05-29/"

MODEL<- "lotkaVolterraParasitism"
TYPE<-"saturating"

IN_FILE<-paste(IN_DIR, MODEL, ".txt", sep = "")
OUT_FILE<-paste(OUT_DIR, MODEL, "_",TYPE,"_fitness.txt", sep = "")

##read the file with the infos----
df.steadyStates<-read.table(IN_FILE, header = TRUE)


##start the simulations ---
fitness<-c()
virulence<-c()
for(i in 1:nrow(df.steadyStates))
{
  #get steady state of the parasite
  P<-df.steadyStates[i,]$P
  alpha<-df.steadyStates[i,]$alpha_2
  parameters<-c(S_v = 1000,
                S_h = 10,
                delta_v = 0.03,
                gamma_v = 0.001,
                nu_v = 0.06,
                S_h = 10,
                delta_h = 0.00001,
                gamma_h = 0.025,
                beta_0 = 0.025,
                nu_0 = 1,
                P,
                alpha,
                h = 0.5)
  r0<-R0(parameters, TYPE)
  fitness<-as.data.frame(rbind(fitness,r0[[1]]))
  virulence<-as.data.frame(rbind(virulence, r0[[2]]))
}

out.df<-cbind(df.steadyStates$alpha_1, df.steadyStates$alpha_2, df.steadyStates$Parasite, fitness, virulence)
colnames(out.df)<-c("alpha1", "alpha2", "Parasite", "fitness", "virulence")

write.table(out.df, OUT_FILE, sep = "\t", row.names = FALSE)

